!function(e,t){for(var r in t)e[r]=t[r]}(self,function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=65)}({6:function(e,t){const r=/(url\s*\(\s*[\\"']*)([^)'"]+)([\\"']*\s*\))/gi,n=/(@import\s*[\\"']*)([^)'";]+)([\\"']*\s*;?)/gi,i=/WB_wombat_/g,s=/(.postMessage\s*\()/;function o(e,t){for(let r of t)if(e.startsWith(r))return!0;return!1}const a=["http://","https://","//"];e.exports=class{constructor(e,t,r){this.baseUrl=e,this.prefix=t||"",this.headInsert=r||""}rewrite(e,t,r){let n=e.headers.get("Content-Type")||"";n=n.split(";",1)[0];const i=this.rewriteHeaders(e.headers);switch(r&&i.append("Content-Security-Policy",r),t){case"style":return this.rewriteCSS(e,i);case"script":return this.rewriteJS(e,i)}switch(n){case"text/html":return this.rewriteHtml(e,i)}return e}rewriteUrl(e){var t=e;return(e=e.trim())?e.startsWith("data:")||e.startsWith("blob:")?t:((e.startsWith("/")||e.startsWith("."))&&(e=new URL(e,this.baseUrl).href),this.prefix+e):t}rewriteMetaContent(e,t){const r=this.getAttr(e,"http-equiv");if("content-security-policy"===r)t.name="_"+t.name;else if("refresh"===r);else{if("referrer"===this.getAttr(e,"name"))return"no-referrer-when-downgrade";if(o(t.value,a))return this.rewriteUrl(t.value)}return t.value}rewriteSrcSet(e){const t=/\s*(\S*\s+[\d\.]+[wx]),|(?:\s*,(?:\s+|(?=https?:)))/;let r=[];for(v of e.split(t))v&&r.push(this.rewriteUrl(v.trim()));return r.join(", ")}rewriteAttrs(e,t){const r=e=>o(e,a);for(let n of e.attrs){const i=n.name,s=n.value;i.startsWith("on")&&s.startsWith("javascript:")&&"-"!=i.slice(2,3)?n.value="javascript:"+this.rewriteJSProxy(s.slice("javascript:".length)):"style"===i?n.value=this.rewriteCSSText(n.value):"background"===i?n.value=this.rewriteUrl(s):"srcset"===i?n.value=this.rewriteSrcSet(s):"crossorigin"===i||"integrity"===i?n.name="_"+n.name:"meta"===e.tagName&&"content"===i?n.value=this.rewriteMetaContent(e.attrs,n):"param"===e.tagName&&r(s)?n.value=this.rewriteUrl(n.value):i.startsWith("data-")&&r(s)?n.value=this.rewriteUrl(n.value):"href"===i||"src"===i?n.value=this.rewriteUrl(n.value):t[n.name]&&(n.value=this.rewriteUrl(n.value))}}getAttr(e,t){for(let r of e)if(r.name===t)return r.value;return null}rewriteHtml(e,t){const r={a:{href:"mp_"},base:{href:"mp_"},applet:{codebase:"oe_",archive:"oe_"},area:{href:"mp_"},audio:{src:"oe_"},base:{href:"mp_"},blockquote:{cite:"mp_"},body:{background:"im_"},button:{formaction:"mp_"},command:{icon:"im_"},del:{cite:"mp_"},embed:{src:"oe_"},iframe:{src:"if_"},image:{src:"im_","xlink:href":"im_",href:"im_"},img:{src:"im_",srcset:"im_"},ins:{cite:"mp_"},input:{src:"im_",formaction:"mp_"},form:{action:"mp_"},frame:{src:"fr_"},link:{href:"oe_"},meta:{content:"mp_"},object:{codebase:"oe_",data:"oe_"},param:{value:"oe_"},q:{cite:"mp_"},ref:{href:"oe_"},script:{src:"js_","xlink:href":"js_"},source:{src:"oe_",srcset:"oe_"},video:{src:"oe_",poster:"im_"}},n=new RewritingStream;let i=!1,s="";n.on("startTag",e=>{const t=r[e.tagName];switch(this.rewriteAttrs(e,t||{}),e.tagName){case"head":n.emitRaw(this.headInsert),i=!0;break;case"base":this.baseUrl=this.getAttr(e.attrs,"href");break;case"script":case"style":e.selfClosing||(s=e.tagName)}n.emitStartTag(e)}),n.on("endTag",e=>{e.tagName==s&&(s=""),n.emitEndTag(e)}),n.on("text",(e,t)=>{"script"===s?n.emitRaw(this.rewriteJSProxy(t)):"style"===s?n.emitRaw(this.rewriteCSSText(t)):n.emitText(e)});const o=new stream.Readable({encoding:"utf-8"});o._read=()=>{},o.pipe(n);const a=e.body.getReader();var c=new TextEncoder("utf-8"),l=new ReadableStream({start(e){n.on("data",function(t){e.enqueue(c.encode(t))}),n.on("end",function(){e.close()}),function e(){return a.read().then(({done:t,value:r})=>{if(!t)return o.push(r),e();o.push(null)})}()}});const u={status:e.status,statusText:e.statusText,headers:t||e.headers};return new Response(l,u)}cssStyleReplacer(e,t,r,n,i,s){return t+this.rewriteUrl(r)+n}rewriteCSSText(e){return e.replace(r,this.cssStyleReplacer.bind(this)).replace(n,this.cssStyleReplacer.bind(this)).replace(i,"")}rewriteCSS(e,t){return e.text().then(e=>this.rewriteCSSText(e)).then(r=>{const n={status:e.status,statusText:e.statusText,headers:t||e.headers};return new Response(r,n)})}rewriteJSProxy(e){if(!e||e.indexOf("_____WB$wombat$assign$function_____")>=0||0===e.indexOf("<"))return e;const t=["window","self","document","location","top","parent","frames","opener"];let r=!1;for(let n of t)if(e.indexOf(n)>=0){r=!0;break}return r?'var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init &&self._wb_wombat.local_init(name)) || self[name]; };\nif (!self.__WB_pmw) { self.__WB_pmw = function(obj) { return obj; } }\n{\nlet window = _____WB$wombat$assign$function_____("window");\nlet self = _____WB$wombat$assign$function_____("self");\nlet document = _____WB$wombat$assign$function_____("document");\nlet location = _____WB$wombat$assign$function_____("location");\nlet top = _____WB$wombat$assign$function_____("top");\nlet parent = _____WB$wombat$assign$function_____("parent");\nlet frames = _____WB$wombat$assign$function_____("frames");\nlet opener = _____WB$wombat$assign$function_____("opener");\n'+(e=e.replace(s,".__WB_pmw(self.window)$1"))+"\n\n}":e}rewriteJS(e,t){return e.text().then(r=>{const n={status:e.status,statusText:e.statusText,headers:t||e.headers};return new Response(this.rewriteJSProxy(r),n)})}rewriteHeaders(e){const t={"access-control-allow-origin":"prefix-if-url-rewrite","access-control-allow-credentials":"prefix-if-url-rewrite","access-control-expose-headers":"prefix-if-url-rewrite","access-control-max-age":"prefix-if-url-rewrite","access-control-allow-methods":"prefix-if-url-rewrite","access-control-allow-headers":"prefix-if-url-rewrite","accept-patch":"keep","accept-ranges":"keep",age:"prefix",allow:"keep","alt-svc":"prefix","cache-control":"prefix",connection:"prefix","content-base":"url-rewrite","content-disposition":"keep","content-encoding":"prefix-if-content-rewrite","content-language":"keep","content-length":"content-length","content-location":"url-rewrite","content-md5":"prefix","content-range":"keep","content-security-policy":"prefix","content-security-policy-report-only":"prefix","content-type":"keep",date:"keep",etag:"prefix",expires:"prefix","last-modified":"prefix",link:"keep",location:"url-rewrite",p3p:"prefix",pragma:"prefix","proxy-authenticate":"keep","public-key-pins":"prefix","retry-after":"prefix",server:"prefix","set-cookie":"cookie",status:"prefix","strict-transport-security":"prefix",trailer:"prefix","transfer-encoding":"transfer-encoding",tk:"prefix",upgrade:"prefix","upgrade-insecure-requests":"prefix",vary:"prefix",via:"prefix",warning:"prefix","www-authenticate":"keep","x-frame-options":"prefix","x-xss-protection":"prefix"};let r=new Headers;for(let n of e.entries())switch(t[n[0]]){case"keep":r.append(n[0],n[1]);break;case"url-rewrite":r.append(n[0],this.rewriteUrl(n[1]));break;case"prefix-if-content-rewrite":case"prefix-if-url-rewrite":r.append("X-Archive-Orig-"+n[0],n[1]);break;case"content-length":if("0"==n[1]){r.append(n[0],n[1]);continue}try{if(parseInt(n[1])>=0){r.append(n[0],n[1]);continue}}catch(e){}r.append("X-Archive-Orig-"+n[0],n[1]);break;case"transfer-encoding":case"prefix":r.append("X-Archive-Orig-"+n[0],n[1]);break;case"cookie":r.append(n[0],n[1]);break;default:r.append(n[0],n[1])}return r}}},65:function(e,t,r){"use strict";r.r(t),r.d(t,"initSW",function(){return n}),r.d(t,"Page",function(){return i});let n=r(66),i=r(67)},66:function(e,t){"serviceWorker"in navigator?navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(e){console.log("Service worker registration succeeded:",e)},function(e){console.log("Service worker registration failed:",e)}):console.log("Service workers are not supported.")},67:function(e,t,r){"use strict";r.r(t),r.d(t,"ReplayIndex",function(){return s});var n=r(7),i=r(8);class s{constructor(){navigator.serviceWorker.addEventListener("message",e=>{switch(e.data.msg_type){case"collAdded":console.log("Collection added: "+e.data.prefix);break;case"listAll":console.log("listAll"),this.addCollections(e.data.colls)}}),new Promise(e=>{if(navigator.serviceWorker.controller)return e();navigator.serviceWorker.addEventListener("controllerchange",t=>e())}).then(()=>{this.init()})}init(){const e=new URLSearchParams(window.location.search);let t=!1;for(let r of e.entries())r[0].startsWith("coll_")&&(t=!0,this.initColl(r[0].slice("coll_".length),r[1]));t||navigator.serviceWorker.controller.postMessage({msg_type:"listAll"})}initColl(e,t){window.fetch(t).then(e=>e.json()).then(t=>{const r=new n.a(e,new i.a(t));navigator.serviceWorker.controller.postMessage({msg_type:"addColl",collection:r})})}processFile(e){navigator.serviceWorker.controller&&Object(i.b)(e[0]).then(function(e){const t=new n.a(document.querySelector("#coll-name").value,e);navigator.serviceWorker.controller.postMessage({msg_type:"addColl",collection:t}),console.log("Setting coll: "+t)})}addCollections(e){document.querySelector("#colls").innerHTML="";for(let t of e)this.addCollection(t)}addCollection(e){let t=`<h3>${e.name}</h3><ul>`;for(let r of e.pageList){let n=e.prefix;r.ts&&(n+=r.ts+"/"),t+=`<li><a href="${n+=r.url}">${r.url}</a></li>`}t+="</ul>";let r=document.createElement("div");r.innerHTML=t,document.querySelector("#colls").appendChild(r)}}},7:function(e,t,r){"use strict";r.d(t,"a",function(){return a});var n=r(6),i=r.n(n);const s="default-src 'unsafe-eval' 'unsafe-inline' 'self' data: blob: mediastream: ws: wss: ; form-action 'self'",o=/^(\d*)([a-z]+_|[$][a-z0-9:.-]+)?\/{0,3}(.+)/;class a{constructor(e,t){this.name=e,this.cache=t,this.prefix=null,this.staticPrefix="/static"}setPrefix(e){this.prefix=e+this.name+"/"}handleRequest(e){if(!e.url.startsWith(this.prefix))return null;const t=e.url.substring(this.prefix.length);let r={status:200,statusText:"OK",headers:{"Content-Type":"text/html"}},n=null;if(""==t){n="<html><body><h2>Available Pages</h2><ul>";for(let e of this.cache.pageList){let t=this.prefix;e.ts&&(t+=e.ts+"/"),n+=`<li><a href="${t+=e.url}">${e.url}</a></li>`}return n+="</ul></body></html>",new Response(n,r)}const a=o.exec(t);if(!a)return this.notFound();const c=a[1],l=a[2],u=a[3];if(l){let t=this.cache.match({url:u});if(t&&"id_"!=l){let r="";""!==e.destination&&"document"!==e.destination||(r=this.makeHeadInsert(u,t.timestamp,e.url,c));const n=new i.a(u,this.prefix+"mp_/",r);console.log(e.destination),e.destination||console.log("empty"),t=n.rewrite(t,e.destination,s)}return t||this.notFound()}return console.log("dest: "+e.destination),this.makeTopFrame(u,c)}notFound(){return new Response("404 Not Found",{status:404,statusText:"Not Found",headers:{"Content-Type":"text/html"}})}makeTopFrame(e,t){const r=`\n<!DOCTYPE html>\n<html>\n<head>\n<style>\nhtml, body\n{\n  height: 100%;\n  margin: 0px;\n  padding: 0px;\n  border: 0px;\n  overflow: hidden;\n}\n\n</style>\n<script src='${this.staticPrefix}/wb_frame.js'> <\/script>\n\n<script src='${this.staticPrefix}/default_banner.js'> <\/script>\n<link rel='stylesheet' href='${this.staticPrefix}/default_banner.css'/>\n\n</head>\n<body style="margin: 0px; padding: 0px;">\n<div id="wb_iframe_div">\n<iframe id="replay_iframe" frameborder="0" seamless="seamless" scrolling="yes" class="wb_iframe"></iframe>\n</div>\n<script>\n  var cframe = new ContentFrame({"url": "${e}" + window.location.hash,\n                                 "prefix": "${this.prefix}",\n                                 "request_ts": "${t}",\n                                 "iframe": "#replay_iframe"});\n\n<\/script>\n</body>\n</html>\n`;return new Response(r,{status:200,statusText:"OK",headers:{"Content-Type":"text/html","Content-Security-Policy":s}})}makeHeadInsert(e,t,r,n){const i=r.replace("mp_/",""),s=this.prefix,o=this.name,a=new URL(e);return`\n\x3c!-- WB Insert --\x3e\n<script>\n  wbinfo = {};\n  wbinfo.top_url = "${i}";\n  // Fast Top-Frame Redirect\n  if (window == window.top && wbinfo.top_url) {\n    var loc = window.location.href.replace(window.location.hash, "");\n    loc = decodeURI(loc);\n \n    if (loc != decodeURI(wbinfo.top_url)) {\n        window.location.href = wbinfo.top_url + window.location.hash;\n    }\n  }\n  wbinfo.url = "${e}";\n  wbinfo.timestamp = "${t}";\n  wbinfo.request_ts = "${n}";\n  wbinfo.prefix = decodeURI("${s}");\n  wbinfo.mod = "mp_";\n  wbinfo.is_framed = true;\n  wbinfo.is_live = false;\n  wbinfo.coll = "${o}";\n  wbinfo.proxy_magic = "";\n  wbinfo.static_prefix = "${this.staticPrefix}/";\n  wbinfo.enable_auto_fetch = true;\n<\/script>\n<script src='${this.staticPrefix}/wombat.js'> <\/script>\n<script>\n  wbinfo.wombat_ts = "${t}";\n  wbinfo.wombat_sec = "";\n  wbinfo.wombat_scheme = "${a.protocol.slice(0,-1)}";\n  wbinfo.wombat_host = "${a.host}";\n\n  wbinfo.wombat_opts = {};\n\n  if (window && window._WBWombatInit) {\n    window._WBWombatInit(wbinfo);\n  }\n<\/script>\n  `}}},8:function(e,t,r){"use strict";function n(e){let t=new FileReader;return t.readAsText(e),new Promise(function(e){t.onloadend=function(){const r=new i(t.result);e(r)}})}r.d(t,"a",function(){return i}),r.d(t,"b",function(){return n});class i{constructor(e){let t=e;"string"==typeof t&&(t=JSON.parse(t)),this.parseEntries(t),this.parsePages(t)}parsePages(e){this.pageList=[];for(let t of e.log.pages)t.pageTimings&&t.pageTimings.onLoad&&this.pageList.push({ts:this.getTS(t.startedDateTime),url:t.title})}parseEntries(e){this.urlMap={};for(let t of e.log.entries)t.response.content&&t.response.content.text&&(this.urlMap[t.request.url]={request:t.request,response:t.response,timestamp:this.getTS(t.startedDateTime)})}getTS(e){return e.replace(/[-:T]/g,"").slice(0,14)}match(e){let t=e.url,r=t.indexOf("#");r>0&&(t=t.substring(0,r));const n=this.urlMap[t];if(!n)return null;const i={};for(let e of n.response.headers)"content-encoding"!==e.name.toLowerCase()&&(i[e.name]=e.value);const s={status:n.response.status,statusText:n.response.statusText,headers:i};let o=null;try{o=Uint8Array.from(atob(n.response.content.text),e=>e.charCodeAt(0))}catch(e){o=n.response.content.text}const a=new Response(o,s);return a.timestamp=n.timestamp,a}}}}));